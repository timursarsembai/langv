<Window x:Class="LangVPlayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LangVPlayer"
        xmlns:vlc="clr-namespace:LibVLCSharp.WPF;assembly=LibVLCSharp.WPF"
        mc:Ignorable="d"
        Title="LangV Player"
        Height="720" Width="1280"
        MinHeight="400" MinWidth="600"
        WindowStyle="None"
        AllowsTransparency="True"
        Icon="langvplayer.ico"
        Background="{StaticResource PrimaryBackgroundBrush}"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        SizeChanged="Window_SizeChanged"
        PreviewKeyDown="Window_PreviewKeyDown"
        PreviewMouseDown="Window_PreviewMouseDown">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="5"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <!-- Style for menu button / Стиль для кнопки меню -->
        <Style x:Key="MenuButtonStyle" TargetType="MenuItem">
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Grid>
                            <Border x:Name="Border" 
                                    Background="Transparent" 
                                    BorderThickness="0"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter ContentSource="Header" 
                                                  HorizontalAlignment="Center" 
                                                  VerticalAlignment="Center"/>
                            </Border>
                            <Popup x:Name="PART_Popup"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                   Placement="Bottom"
                                   PlacementTarget="{Binding ElementName=Border}"
                                   PopupAnimation="Fade">
                                <Border Background="#FF2D2D30" 
                                        BorderBrush="#FF3F3F46" 
                                        BorderThickness="1"
                                        Margin="0,0,8,8">
                                    <Border.Effect>
                                        <DropShadowEffect ShadowDepth="2" Opacity="0.5" BlurRadius="5"/>
                                    </Border.Effect>
                                    <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle"/>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#40FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#40FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <!-- Main content / Основной контент -->
            <ColumnDefinition Width="*"/>
            <!-- Playlist panel / Панель плейлиста -->
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Player Area / Основная область плеера -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <!-- TitleBar / Заголовок -->
                <RowDefinition x:Name="TitleBarRow" Height="30"/>
                <!-- Video Area / Область видео -->
                <RowDefinition Height="*"/>
                <!-- Control Panel / Панель управления -->
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

        <!-- Custom TitleBar / Кастомный заголовок -->
        <Grid x:Name="TitleBar" Grid.Row="0" Background="{StaticResource TitleBarBrush}" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Menu / Меню -->
            <Menu Grid.Column="0" 
                  Background="Transparent" 
                  Foreground="{StaticResource TextBrush}" 
                  VerticalAlignment="Center"
                  Margin="5,0,0,0"
                  FontSize="14">
                <MenuItem x:Name="MenuButton" 
                          Header="☰" 
                          FontSize="18" 
                          FontWeight="Bold"
                          Style="{StaticResource MenuButtonStyle}">
                        <!-- File Menu / Меню Файл -->
                        <MenuItem x:Name="MenuFile" Header="Файл">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <MenuItem x:Name="MenuOpenFile" Header="Открыть файл..." Click="MenuOpenFile_Click" InputGestureText="Ctrl+O">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuExit" Header="Выход" Click="CloseButton_Click" InputGestureText="Alt+F4">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE7E8;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <!-- Playback Menu / Меню Воспроизведение -->
                    <MenuItem x:Name="MenuPlayback" Header="Воспроизведение">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <MenuItem x:Name="MenuPlayPause" Header="Воспроизвести" Click="PlayPauseButton_Click" InputGestureText="Space">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuStop" Header="Стоп" Click="MenuStop_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE71A;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuRewind" Header="Назад (-10с)" Click="RewindButton_Click" InputGestureText="←">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xEB9E;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuForward" Header="Вперёд (+10с)" Click="ForwardButton_Click" InputGestureText="→">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xEB9D;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuVolumeUp" Header="Громкость +" Click="MenuVolumeUp_Click" InputGestureText="↑">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE995;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuVolumeDown" Header="Громкость -" Click="MenuVolumeDown_Click" InputGestureText="↓">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE993;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <!-- Speed Submenu / Подменю скорости -->
                        <MenuItem x:Name="MenuSpeed" Header="Скорость">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xEC57;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                            <MenuItem x:Name="MenuSpeedUp" Header="Увеличить скорость" Click="SpeedUp_Click" InputGestureText="]"/>
                            <MenuItem x:Name="MenuSpeedDown" Header="Уменьшить скорость" Click="SpeedDown_Click" InputGestureText="["/>
                            <MenuItem x:Name="MenuSpeedReset" Header="Сбросить (1.0x)" Click="SpeedReset_Click" InputGestureText="Backspace"/>
                            <Separator/>
                            <MenuItem x:Name="Speed025" Header="0.25x" Click="SpeedPreset_Click" Tag="0.25"/>
                            <MenuItem x:Name="Speed050" Header="0.5x" Click="SpeedPreset_Click" Tag="0.5"/>
                            <MenuItem x:Name="Speed075" Header="0.75x" Click="SpeedPreset_Click" Tag="0.75"/>
                            <MenuItem x:Name="Speed100" Header="1.0x (норм.)" Click="SpeedPreset_Click" Tag="1.0"/>
                            <MenuItem x:Name="Speed125" Header="1.25x" Click="SpeedPreset_Click" Tag="1.25"/>
                            <MenuItem x:Name="Speed150" Header="1.5x" Click="SpeedPreset_Click" Tag="1.5"/>
                            <MenuItem x:Name="Speed175" Header="1.75x" Click="SpeedPreset_Click" Tag="1.75"/>
                            <MenuItem x:Name="Speed200" Header="2.0x" Click="SpeedPreset_Click" Tag="2.0"/>
                        </MenuItem>
                    </MenuItem>
                    <!-- Audio Menu / Меню Аудио -->
                    <MenuItem x:Name="MenuAudio" Header="Аудио">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xE767;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <!-- Audio Tracks submenu / Подменю аудиодорожек -->
                        <MenuItem x:Name="MenuAudioTracks" Header="Аудиодорожка">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8D6;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                            <!-- Dynamic items added in code / Динамические элементы добавляются в коде -->
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuVolumeUpAudio" Header="Увеличить громкость" Click="MenuVolumeUp_Click" InputGestureText="↑">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE995;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuVolumeDownAudio" Header="Уменьшить громкость" Click="MenuVolumeDown_Click" InputGestureText="↓">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE993;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuMute" Header="Выключить звук" Click="MenuMute_Click" InputGestureText="M">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE74F;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <!-- View Menu / Меню Вид -->
                    <MenuItem x:Name="MenuView" Header="Вид">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xE740;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <MenuItem x:Name="MenuFullscreen" Header="На полный экран" Click="FullscreenButton_Click" InputGestureText="F11">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE740;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuCompactMode" Header="Компактный режим" Click="CompactModeButton_Click" InputGestureText="P">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xEE47;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuAlwaysOnTop" Header="Поверх всех окон" IsCheckable="True" 
                                  Checked="MenuAlwaysOnTop_Checked" Unchecked="MenuAlwaysOnTop_Unchecked">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE718;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <!-- Subtitles Menu / Меню Субтитры -->
                    <MenuItem x:Name="MenuSubtitles" Header="Субтитры">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xE8BD;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <!-- Embedded subtitles 1 submenu / Подменю встроенных субтитров 1 -->
                        <MenuItem x:Name="MenuEmbeddedSubs1" Header="Встроенные (слот 1)">
                            <MenuItem.Icon>
                                <TextBlock Text="1️⃣" FontSize="12"/>
                            </MenuItem.Icon>
                            <MenuItem x:Name="MenuEmbeddedSubs1None" Header="Отключить" IsCheckable="True" IsChecked="True"
                                      Click="MenuEmbeddedSubs1None_Click"/>
                            <Separator/>
                            <!-- Dynamic items added in code / Динамические элементы добавляются в коде -->
                        </MenuItem>
                        <!-- Embedded subtitles 2 submenu / Подменю встроенных субтитров 2 -->
                        <MenuItem x:Name="MenuEmbeddedSubs2" Header="Встроенные (слот 2)">
                            <MenuItem.Icon>
                                <TextBlock Text="2️⃣" FontSize="12"/>
                            </MenuItem.Icon>
                            <MenuItem x:Name="MenuEmbeddedSubs2None" Header="Отключить" IsCheckable="True" IsChecked="True"
                                      Click="MenuEmbeddedSubs2None_Click"/>
                            <Separator/>
                            <!-- Dynamic items added in code / Динамические элементы добавляются в коде -->
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuLoadPrimarySubs" Header="Загрузить внешние субтитры 1..." 
                                  Click="MenuLoadPrimarySubs_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuLoadSecondarySubs" Header="Загрузить внешние субтитры 2..." 
                                  Click="MenuLoadSecondarySubs_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuTogglePrimarySubs" Header="Субтитры 1: (нет)" IsCheckable="True" IsChecked="True"
                                  Checked="MenuTogglePrimarySubs_Changed" Unchecked="MenuTogglePrimarySubs_Changed"/>
                        <MenuItem x:Name="MenuToggleSecondarySubs" Header="Субтитры 2: (нет)" IsCheckable="True" IsChecked="True"
                                  Checked="MenuToggleSecondarySubs_Changed" Unchecked="MenuToggleSecondarySubs_Changed"/>
                        <Separator/>
                        <MenuItem x:Name="MenuClearAllSubs" Header="Очистить все субтитры" Click="MenuClearAllSubs_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                    <!-- Language Menu / Меню Язык -->
                    <MenuItem x:Name="MenuLanguage" Header="Язык">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xF2B7;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <MenuItem x:Name="MenuLanguageEnglish" Header="English" Click="MenuLanguage_Click" Tag="en" IsCheckable="True"/>
                        <MenuItem x:Name="MenuLanguageRussian" Header="Русский" Click="MenuLanguage_Click" Tag="ru" IsCheckable="True"/>
                    </MenuItem>
                    <!-- Help Menu / Меню Справка -->
                    <MenuItem x:Name="MenuHelp" Header="Справка">
                        <MenuItem.Icon>
                            <TextBlock Text="&#xE897;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                        </MenuItem.Icon>
                        <MenuItem x:Name="MenuAbout" Header="О программе..." Click="MenuAbout_Click">
                            <MenuItem.Icon>
                                <TextBlock Text="&#xE946;" FontFamily="Segoe MDL2 Assets" FontSize="12"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </MenuItem>
                </MenuItem>
            </Menu>

            <!-- App Title / Название приложения -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="5,0">
                <Image Source="langvplayer.png" Width="20" Height="20" VerticalAlignment="Center" Margin="0,0,8,0" RenderOptions.BitmapScalingMode="HighQuality"/>
                <TextBlock Text="LangV Player" Foreground="{StaticResource TextBrush}" FontSize="12" VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Window Buttons / Кнопки окна -->
            <StackPanel Grid.Column="3" Orientation="Horizontal">
                <!-- Pin Button / Кнопка закрепления -->
                <ToggleButton x:Name="PinButton" 
                              Style="{StaticResource PinButtonStyle}" 
                              Content="&#xE718;"
                              ToolTip="Always on Top"
                              Focusable="False"
                              Checked="PinButton_Checked"
                              Unchecked="PinButton_Unchecked"/>
                
                <!-- Minimize Button / Кнопка сворачивания -->
                <Button Style="{StaticResource TitleBarButtonStyle}" 
                        Content="&#xE921;" 
                        Focusable="False"
                        Click="MinimizeButton_Click"
                        ToolTip="Minimize"/>
                
                <!-- Maximize Button / Кнопка развертывания -->
                <Button x:Name="MaximizeButton"
                        Style="{StaticResource TitleBarButtonStyle}" 
                        Content="&#xE922;" 
                        Focusable="False"
                        Click="MaximizeButton_Click"
                        ToolTip="Maximize"/>
                
                <!-- Close Button / Кнопка закрытия -->
                <Button Style="{StaticResource CloseButtonStyle}" 
                        Content="&#xE8BB;" 
                        Focusable="False"
                        Click="CloseButton_Click"
                        ToolTip="Close"/>
            </StackPanel>
        </Grid>

        <!-- Video Area / Область видео -->
        <Grid Grid.Row="1" Background="Black" x:Name="VideoArea">
            <!-- VLC VideoView for video playback / VLC VideoView для воспроизведения видео -->
            <!-- Mouse overlay must be INSIDE VideoView with semi-transparent background per LibVLCSharp docs -->
            <!-- Слой для событий мыши должен быть ВНУТРИ VideoView с полупрозрачным фоном по документации LibVLCSharp -->
            <vlc:VideoView x:Name="VideoView" Background="Black">
                <Grid>
                    <!-- Invisible overlay for mouse events / Невидимый слой для событий мыши -->
                    <Grid x:Name="VideoOverlay" 
                          Background="#01000000"
                          MouseLeftButtonDown="VideoOverlay_MouseLeftButtonDown"
                          MouseMove="VideoOverlay_MouseMove"
                          MouseWheel="VideoOverlay_MouseWheel"/>
                    
                    <!-- Placeholder when no video (on top of overlay) / Заглушка при отсутствии видео (поверх overlay) -->
                    <StackPanel x:Name="NoVideoPlaceholder" 
                                VerticalAlignment="Center" 
                                HorizontalAlignment="Center"
                                Visibility="Visible">
                        <TextBlock Text="🎬" FontSize="64" HorizontalAlignment="Center" Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock x:Name="PlaceholderText"
                                   Text="Drop video file here or click to open" 
                                   Foreground="{StaticResource TextSecondaryBrush}" 
                                   FontSize="16" 
                                   HorizontalAlignment="Center"
                                   Margin="0,10,0,0"/>
                        <Button x:Name="OpenFileButton" 
                                Content="📁 Open Video" 
                                Margin="0,20,0,0"
                                Padding="20,10"
                                Background="{StaticResource AccentBrush}"
                                Foreground="White"
                                BorderThickness="0"
                                FontSize="14"
                                Focusable="False"
                                Cursor="Hand"
                                Click="OpenFileButton_Click"/>
                    </StackPanel>
                    
                    <!-- Subtitle Overlay / Слой субтитров -->
                    <Grid x:Name="SubtitleOverlay" 
                          VerticalAlignment="Bottom" 
                          Margin="20,0,20,60"
                          IsHitTestVisible="False">
                        <Grid.RowDefinitions>
                            <!-- Primary subtitles (foreign language) / Основные субтитры (иностранный язык) -->
                            <RowDefinition Height="Auto"/>
                            <!-- Secondary subtitles (translation) / Вторые субтитры (перевод) -->
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Primary Subtitle Text / Текст основных субтитров -->
                        <Border Grid.Row="0" 
                                x:Name="PrimarySubtitleBorder"
                                Background="#CC000000" 
                                CornerRadius="4" 
                                Padding="12,6"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,5"
                                Visibility="Collapsed"
                                MaxHeight="150">
                            <TextBlock x:Name="PrimarySubtitleText"
                                       Foreground="White"
                                       FontSize="22"
                                       FontWeight="Medium"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap"/>
                        </Border>
                        
                        <!-- Secondary Subtitle Text / Текст вторых субтитров -->
                        <Border Grid.Row="1" 
                                x:Name="SecondarySubtitleBorder"
                                Background="#AA000000" 
                                CornerRadius="4" 
                                Padding="10,4"
                                HorizontalAlignment="Center"
                                Visibility="Collapsed"
                                MaxHeight="100">
                            <TextBlock x:Name="SecondarySubtitleText"
                                       Foreground="#FFD0D0D0"
                                       FontSize="18"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap"/>
                        </Border>
                    </Grid>
                </Grid>
            </vlc:VideoView>
        </Grid>

        <!-- Control Panel / Панель управления -->
        <Grid Grid.Row="2" x:Name="ControlPanel" Background="{StaticResource SecondaryBackgroundBrush}" Height="120">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Timeline Slider / Ползунок таймлайна -->
            <Grid Grid.Row="0" Margin="15,10,15,0">
                <Slider x:Name="TimelineSlider" 
                        Style="{StaticResource VideoSliderStyle}"
                        Minimum="0" 
                        Maximum="100" 
                        Value="0"
                        Focusable="False"
                        ValueChanged="TimelineSlider_ValueChanged"
                        Thumb.DragStarted="TimelineSlider_DragStarted"
                        Thumb.DragCompleted="TimelineSlider_DragCompleted"/>
                
                <!-- Transparent overlay for thumbnail preview mouse tracking -->
                <!-- Прозрачный слой для отслеживания мыши и показа миниатюр -->
                <Border x:Name="TimelineMouseTracker"
                        Background="Transparent"
                        IsHitTestVisible="True"
                        MouseMove="TimelineMouseTracker_MouseMove"
                        MouseLeave="TimelineMouseTracker_MouseLeave"
                        MouseLeftButtonDown="TimelineMouseTracker_MouseLeftButtonDown"
                        MouseLeftButtonUp="TimelineMouseTracker_MouseLeftButtonUp"/>
                
                <!-- Thumbnail Preview Popup / Popup превью миниатюры -->
                <Popup x:Name="ThumbnailPopup" 
                       Placement="Top" 
                       PlacementTarget="{Binding ElementName=TimelineSlider}"
                       AllowsTransparency="True"
                       PopupAnimation="Fade"
                       IsOpen="False"
                       HorizontalOffset="0"
                       VerticalOffset="-5">
                    <Border Background="{StaticResource SecondaryBackgroundBrush}" 
                            BorderBrush="{StaticResource BorderBrush}" 
                            BorderThickness="1" 
                            CornerRadius="4"
                            Padding="4">
                        <StackPanel>
                            <!-- Thumbnail Image / Изображение миниатюры -->
                            <Border x:Name="ThumbnailImageBorder"
                                    Width="200" Height="112"
                                    Background="#1E1E1E"
                                    CornerRadius="2"
                                    Visibility="Collapsed">
                                <Image x:Name="ThumbnailImage" 
                                       Stretch="Uniform"/>
                            </Border>
                            <!-- Time Label / Метка времени -->
                            <TextBlock x:Name="ThumbnailTimeText"
                                       Text="00:00"
                                       Foreground="{StaticResource TextBrush}"
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Border>
                </Popup>
            </Grid>

            <!-- Controls / Элементы управления -->
            <Grid Grid.Row="1" Margin="15,5,15,10">
                <!-- Playback Controls centered in window / Кнопки воспроизведения по центру окна -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- Rewind / Перемотка назад -->
                    <Button Style="{StaticResource ControlButtonStyle}" 
                            Content="&#xEB9E;" 
                            Width="40" Height="40"
                            Focusable="False"
                            VerticalAlignment="Center"
                            Click="RewindButton_Click"
                            ToolTip="Rewind 10s"/>
                    
                    <!-- Play/Pause / Воспроизведение/Пауза -->
                    <Button x:Name="PlayPauseButton" 
                            Style="{StaticResource ControlButtonStyle}" 
                            Content="&#xE768;" 
                            Width="50" Height="50"
                            Focusable="False"
                            VerticalAlignment="Center"
                            Click="PlayPauseButton_Click"
                            ToolTip="Play/Pause"/>
                    
                    <!-- Forward / Перемотка вперед -->
                    <Button Style="{StaticResource ControlButtonStyle}" 
                            Content="&#xEB9D;"
                            Focusable="False" 
                            Width="40" Height="40"
                            VerticalAlignment="Center"
                            Click="ForwardButton_Click"
                            ToolTip="Forward 10s"/>
                </StackPanel>

                <!-- Time Display on left / Отображение времени слева -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <TextBlock x:Name="CurrentTimeText" 
                               Text="00:00:00" 
                               Foreground="{StaticResource TextBrush}" 
                               FontSize="12"
                               VerticalAlignment="Center"/>
                    <TextBlock Text=" / " 
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               FontSize="12"
                               VerticalAlignment="Center"/>
                    <TextBlock x:Name="TotalTimeText" 
                               Text="00:00:00" 
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               FontSize="12"
                               VerticalAlignment="Center"/>
                    
                    <!-- Speed Control / Управление скоростью -->
                    <Border Background="#3F3F46" 
                            CornerRadius="4" 
                            Margin="15,0,0,0" 
                            Padding="2"
                            VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="SpeedDownButton"
                                    Content="&#xE96F;"
                                    FontFamily="Segoe MDL2 Assets"
                                    FontSize="10"
                                    Width="24" Height="24"
                                    Background="Transparent"
                                    Foreground="{StaticResource TextBrush}"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    Focusable="False"
                                    Click="SpeedDown_Click"
                                    ToolTip="Slower (Shift+[)"/>
                            <TextBlock x:Name="SpeedText"
                                       Text="1.0x"
                                       Foreground="{StaticResource TextBrush}"
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       Width="36"
                                       TextAlignment="Center"
                                       VerticalAlignment="Center"
                                       Cursor="Hand"
                                       MouseLeftButtonDown="SpeedText_MouseLeftButtonDown"
                                       ToolTip="Reset speed"/>
                            <Button x:Name="SpeedUpButton"
                                    Content="&#xE970;"
                                    FontFamily="Segoe MDL2 Assets"
                                    FontSize="10"
                                    Width="24" Height="24"
                                    Background="Transparent"
                                    Foreground="{StaticResource TextBrush}"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    Focusable="False"
                                    Click="SpeedUp_Click"
                                    ToolTip="Faster (Shift+])"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Volume & Fullscreen on right / Громкость и полный экран справа -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <!-- Volume Icon (clickable to mute) / Иконка громкости (клик для mute) -->
                    <TextBlock x:Name="VolumeIcon" 
                               Text="&#xE767;" 
                               FontFamily="Segoe MDL2 Assets" 
                               FontSize="16"
                               Foreground="{StaticResource TextBrush}" 
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"
                               Cursor="Hand"
                               MouseLeftButtonDown="VolumeIcon_MouseLeftButtonDown"
                               ToolTip="Mute"/>
                    
                    <!-- Volume Slider / Ползунок громкости -->
                    <Slider x:Name="VolumeSlider" 
                            Width="80" 
                            Minimum="0" 
                            Maximum="200" 
                            Value="100"
                            IsMoveToPointEnabled="True"
                            Focusable="False"
                            VerticalAlignment="Center"
                            ValueChanged="VolumeSlider_ValueChanged"/>
                    
                    <!-- Volume Percentage / Процент громкости -->
                    <TextBlock x:Name="VolumePercentText"
                               Text="100%"
                               Foreground="{StaticResource TextBrush}"
                               FontSize="12"
                               Width="35"
                               TextAlignment="Right"
                               VerticalAlignment="Center"
                               Margin="5,0,0,0"/>
                    
                    <!-- Playlist Button / Кнопка плейлиста -->
                    <Button x:Name="PlaylistButton"
                            Style="{StaticResource ControlButtonStyle}" 
                            Content="&#xE8FD;" 
                            Width="40" Height="40"
                            Margin="5,0,0,0"
                            Focusable="False"
                            Click="PlaylistButton_Click"
                            ToolTip="Playlist"/>
                    
                    <!-- Compact/PiP Mode Button / Кнопка компактного режима -->
                    <Button x:Name="CompactModeButton"
                            Style="{StaticResource ControlButtonStyle}" 
                            Content="&#xEE47;" 
                            Width="40" Height="40"
                            Margin="5,0,0,0"
                            Focusable="False"
                            Click="CompactModeButton_Click"
                            ToolTip="Compact Mode (P)"/>
                    
                    <!-- Fullscreen Button / Кнопка полного экрана -->
                    <Button x:Name="FullscreenButton"
                            Style="{StaticResource ControlButtonStyle}" 
                            Content="&#xE740;" 
                            Width="40" Height="40"
                            Margin="5,0,0,0"
                            Focusable="False"
                            Click="FullscreenButton_Click"
                            ToolTip="Fullscreen"/>
                </StackPanel>
            </Grid>
        </Grid>
        </Grid>
        
        <!-- Playlist Panel / Панель плейлиста -->
        <Grid x:Name="PlaylistPanel" Grid.Column="1" Width="300" Background="{StaticResource SecondaryBackgroundBrush}"
              Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Playlist Header / Заголовок плейлиста -->
            <Grid Grid.Row="0" Background="{StaticResource TitleBarBrush}">
                <TextBlock Text="📋 Плейлист" 
                           Foreground="{StaticResource TextBrush}" 
                           FontSize="14" 
                           VerticalAlignment="Center" 
                           Margin="10,0,0,0"/>
                
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,5,0">
                    <!-- Add Files Button / Кнопка добавления файлов -->
                    <Button Style="{StaticResource TitleBarButtonStyle}"
                            Content="&#xE710;"
                            Focusable="False"
                            Click="PlaylistAddFiles_Click"
                            ToolTip="Add files"/>
                    
                    <!-- Clear Playlist Button / Кнопка очистки плейлиста -->
                    <Button Style="{StaticResource TitleBarButtonStyle}"
                            Content="&#xE74D;"
                            Focusable="False"
                            Click="PlaylistClear_Click"
                            ToolTip="Clear playlist"/>
                </StackPanel>
            </Grid>
            
            <!-- Playlist Items / Элементы плейлиста -->
            <ListBox x:Name="PlaylistListBox" 
                     Grid.Row="1" 
                     Background="Transparent"
                     BorderThickness="0"
                     Foreground="{StaticResource TextBrush}"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     SelectionMode="Single"
                     MouseDoubleClick="PlaylistListBox_MouseDoubleClick">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListBoxItem">
                                    <Border x:Name="Bd" 
                                            Background="Transparent" 
                                            Padding="{TemplateBinding Padding}"
                                            BorderThickness="0,0,0,1"
                                            BorderBrush="{StaticResource BorderBrush}">
                                        <ContentPresenter/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="#30FFFFFF"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter TargetName="Bd" Property="Background" Value="{StaticResource AccentBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Playing indicator / Индикатор воспроизведения -->
                            <TextBlock Grid.Column="0" 
                                       Text="▶" 
                                       Foreground="{StaticResource AccentBrush}"
                                       FontSize="12"
                                       Margin="0,0,8,0"
                                       VerticalAlignment="Center"
                                       Visibility="{Binding IsPlaying, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            
                            <!-- File name / Имя файла -->
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding FileName}" 
                                       Foreground="{StaticResource TextBrush}"
                                       TextTrimming="CharacterEllipsis"
                                       VerticalAlignment="Center"
                                       ToolTip="{Binding FilePath}"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </Grid>
</Window>
